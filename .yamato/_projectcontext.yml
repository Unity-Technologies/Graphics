
# This file is generated by ant_yaml_generation package, don't edit this file manually.
# Introduce any changes under .yamato/config/*.metafile files and rerun yaml-generation (or check #devs-automation-tooling).

{% metadata_file .yamato/_cache_config.metafile -%}
{% metadata_file .yamato/_latest_editor_versions_2021.2.metafile -%}

---

pack_all_project:
    name: Pack all [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci project pack --project-path TestProjects/SRP_SmokeTest
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_core_project:
    name: Publish Core [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.core
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_core_project_dry:
    name: Publish Core [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.core --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_shadergraph_project:
    name: Publish ShaderGraph [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.shadergraph
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_shadergraph_project_dry:
    name: Publish ShaderGraph [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.shadergraph --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_hdrp_project:
    name: Publish HDRP [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.high-definition
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_hdrp_project_dry:
    name: Publish HDRP [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.high-definition --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_universal_project:
    name: Publish Universal [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.universal
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_universal_project_dry:
    name: Publish Universal [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.universal --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_vfx_project:
    name: Publish VFX [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.visualeffectgraph
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_vfx_project_dry:
    name: Publish VFX [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.visualeffectgraph --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_config_project:
    name: Publish Config [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.high-definition-config
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
publish_config_project_dry:
    name: Publish Config [project context] [dry run]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package publish --package-path com.unity.render-pipelines.high-definition-config --dry-run
    artifacts:
        packages:
            paths:
              -  "upm-ci~/packages/**/*"
test_all_project_Win_2021.3:
    name: Test all packages [project context] Win 2021.3
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:2021.3:Win
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u .\.Editor --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
    variables:
        CUSTOM_REVISION: '{{2021_3.changeset.id}}'
test_all_project_OSX_2021.3:
    name: Test all packages [project context] OSX 2021.3
    agent:
        type: Unity::VM::osx
        image: package-ci/mac:stable
        flavor: m1.mac
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:2021.3:OSX
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u $(pwd)/.Editor/Unity.app/Contents/MacOS/Unity --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
    variables:
        CUSTOM_REVISION: '{{2021_3.changeset.id}}'
test_all_project_Win_CUSTOM-REVISION:
    name: Test all packages [project context] Win CUSTOM-REVISION
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:CUSTOM-REVISION:Win
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u .\.Editor --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
    variables:
        CUSTOM_REVISION: custom_revision_not_set
test_all_project_OSX_CUSTOM-REVISION:
    name: Test all packages [project context] OSX CUSTOM-REVISION
    agent:
        type: Unity::VM::osx
        image: package-ci/mac:stable
        flavor: m1.mac
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:CUSTOM-REVISION:OSX
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u $(pwd)/.Editor/Unity.app/Contents/MacOS/Unity --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
    variables:
        CUSTOM_REVISION: custom_revision_not_set
test_all_project_Win_min_editor:
    name: Test minimum editor version - all packages [project context] Win
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:test_min_editor:Win
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u .\.Editor --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
test_all_project_OSX_min_editor:
    name: Test minimum editor version - all packages [project context] OSX
    agent:
        type: Unity::VM::osx
        image: package-ci/mac:stable
        flavor: m1.mac
    dependencies:
      -  .yamato/_projectcontext.yml#pack_all_project
      -  .yamato/_editor_priming.yml#editor:priming:test_min_editor:OSX
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple --upgrade
      -  unity-downloader-cli --source-file unity_revision.txt -c editor --wait --published-only
      -  upm-ci project test -u $(pwd)/.Editor/Unity.app/Contents/MacOS/Unity --project-path TestProjects/SRP_SmokeTest --type vetting-tests --extra-create-project-arg="-upmNoDefaultPackages"
    artifacts:
        logs:
            paths:
              -  "**/test-results/**"
all_package_ci_project_2021.3:
    name: Pack and test all packages - 2021.3 [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#test_all_project_Win_2021.3
      -  .yamato/_projectcontext.yml#test_all_project_OSX_2021.3
    variables:
        CUSTOM_REVISION: '{{2021_3.changeset.id}}'
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package izon -t
      -  upm-ci package izon -d
all_package_ci_project_CUSTOM-REVISION:
    name: Pack and test all packages - CUSTOM-REVISION [project context]
    agent:
        type: Unity::VM
        image: package-ci/win10:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#test_all_project_Win_CUSTOM-REVISION
      -  .yamato/_projectcontext.yml#test_all_project_OSX_CUSTOM-REVISION
    variables:
        CUSTOM_REVISION: custom_revision_not_set
    commands:
      -  npm install upm-ci-utils@stable -g --registry https://artifactory.prd.cds.internal.unity3d.com/artifactory/api/npm/upm-npm
      -  upm-ci package izon -t
      -  upm-ci package izon -d
publish_all_project:
    name: Publish all packages [project context][recurrent]
    dependencies:
      -  .yamato/_projectcontext.yml#publish_core_project
      -  .yamato/_projectcontext.yml#publish_shadergraph_project
      -  .yamato/_projectcontext.yml#publish_hdrp_project
      -  .yamato/_projectcontext.yml#publish_universal_project
      -  .yamato/_projectcontext.yml#publish_vfx_project
      -  .yamato/_projectcontext.yml#publish_config_project
publish_all_project_tag:
    name: Publish all packages [project context][manual][tag]
    agent:
        type: Unity::VM
        image: package-ci/ubuntu:stable
        flavor: b1.large
    dependencies:
      -  .yamato/_projectcontext.yml#publish_core_project
      -  .yamato/_projectcontext.yml#publish_shadergraph_project
      -  .yamato/_projectcontext.yml#publish_hdrp_project
      -  .yamato/_projectcontext.yml#publish_universal_project
      -  .yamato/_projectcontext.yml#publish_vfx_project
      -  .yamato/_projectcontext.yml#publish_config_project
    commands:
      -  git tag v$(cd com.unity.render-pipelines.core && node -e "console.log(require('./package.json').version)")
      -  git push origin --tags
